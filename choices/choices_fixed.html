<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Choose Your Mood 💜</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='choices/choices.css') }}" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <div class="choices-card">
      <div class="mood-emoji">🌈</div>
      <h1 class="choices-title">Choose your current mood!</h1>
      <div class="sparkles">✨💜✨</div>

      <div class="mood-grid">
        <button class="mood-button sad-btn" onclick="goToMood('sadpage')">
          <div class="mood-icon">😢</div><span>Sad</span>
        </button>
        <button class="mood-button happy-btn" onclick="goToMood('happypage')">
          <div class="mood-icon">😊</div><span>Happy</span>
        </button>
        <button class="mood-button missing-btn" onclick="goToMood('missingpage')">
          <div class="mood-icon">🥺</div><span>Missing Me</span>
        </button>
        <button class="mood-button angry-btn" onclick="goToMood('angrypage')">
          <div class="mood-icon">😠</div><span>Angry</span>
        </button>
        <button class="mood-button confused-btn" onclick="goToMood('confusedpage')">
          <div class="mood-icon">😕</div><span>Confused</span>
        </button>
        <button class="mood-button hurt-btn" onclick="goToMood('hurtpage')">
          <div class="mood-icon">💔</div><span>Hurt</span>
        </button>
        <button class="mood-button fine-btn" onclick="goToMood('finepage')">
          <div class="mood-icon">😌</div><span>Fine</span>
        </button>
      </div>

      <div class="back-container">
        <button class="back-button" onclick="goBack()"><span>← Back</span></button>
      </div>
    </div>

    <div class="floating-elements">
      <div class="float-emoji">💜</div>
      <div class="float-emoji">💕</div>
      <div class="float-emoji">✨</div>
      <div class="float-emoji">🌟</div>
    </div>
  </div>

  <script>
    const moodRoutes = {
      sadpage: '/sadpage',
      happypage: '/happypage',
      missingpage: '/missingpage',
      angrypage: '/angrypage',
      confusedpage: '/confusedpage',
      hurtpage: '/hurtpage',
      finepage: '/finepage'
    };

    function goToMood(mood) {
      localStorage.setItem('previousPage', 'choices');
      const url = moodRoutes[mood];
      if (url) window.location.href = url;
    }

    function goBack() {
      window.location.href = '/';
    }
    // Auto-resume background music on this page
    (function(){
      function resume(){
        try{
          const s = localStorage.getItem('bgm_song');
          const p = localStorage.getItem('bgm_playing') === 'true';
          const t = parseFloat(localStorage.getItem('bgm_time') || '0');
          if (s && p && !window._bgm) {
            const a = new Audio(`/me/music/${s}`);
            a.loop = true;
            a.addEventListener('loadedmetadata', ()=>{ if(!isNaN(t)){ try{ a.currentTime = t }catch(e){} } });
            a.play().then(()=>{
              window._bgm = a;
              a.ontimeupdate = ()=>{ try{ localStorage.setItem('bgm_time', String(a.currentTime||0)) }catch(e){} };
            }).catch(()=>{});
          }
        }catch(e){}
      }
      if (document.readyState === 'complete') resume(); else window.addEventListener('load', resume);
    })();
  </script>
</body>
</html>
